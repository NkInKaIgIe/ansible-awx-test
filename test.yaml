---
- name: Shell mkdir
  hosts: pulledge
  tasks:
    - name: edge
      shell: |
        cat << EOF > /etc/sysconfig/iptables
        # Generated by iptables-save v1.4.21 on Mon Nov 28 09:37:42 2022
        *filter
        :INPUT ACCEPT [0:0]
        :FORWARD ACCEPT [0:0]
        :OUTPUT ACCEPT [534394:1391496525]
        -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
        -A INPUT -p udp -s 103.113.80.0/29 --dport 161 -j ACCEPT
        -A INPUT -p icmp -j ACCEPT
        -A INPUT -i lo -j ACCEPT
        -A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT
        -A INPUT -p tcp -m state --state NEW -m tcp --dport 9000 -j ACCEPT
        -A INPUT -p tcp -m state --state NEW -m tcp --dport 13334 -j ACCEPT
        -A INPUT -p tcp -m state --state NEW -m tcp --dport 3329 -j ACCEPT
        -A INPUT -p tcp -m state --state NEW -m tcp --dport 3478 -j ACCEPT
        -A INPUT -p tcp -m state --state NEW -m tcp --dport 443 -j ACCEPT
        -A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT
        -A INPUT -p udp -m state --state NEW -m udp --dport 10000 -j ACCEPT
        -A INPUT -p udp -m state --state NEW -m udp --dport 10001 -j ACCEPT
        -A INPUT -p udp -m state --state NEW -m udp --dport 10002 -j ACCEPT
        -A INPUT -p udp -m state --state NEW -m udp --dport 10003 -j ACCEPT
        -A INPUT -p udp -m state --state NEW -m udp --dport 10004 -j ACCEPT
        -A INPUT -p udp -m state --state NEW -m udp --dport 10005 -j ACCEPT
        -A INPUT -p udp -m state --state NEW -m udp --dport 10006 -j ACCEPT
        -A INPUT -j REJECT --reject-with icmp-host-prohibited
        -A FORWARD -j REJECT --reject-with icmp-host-prohibited
        COMMIT
        # Completed on Mon Nov 28 09:37:42 2022
        EOF
        sudo systemctl restart iptables
